-- rq = {};
-- rq.GET = {};

-- rq.GET["cmd"	] = "event";
-- rq.GET["gw"	] = "192.168.1.3";
-- rq.GET["dns2"	] = "192.168.1.3";
-- rq.GET["dns1"	] = "192.168.1.3";
-- rq.GET["iface"	] = "PPP";
-- rq.GET["eventtype"] = "linkup";

-- r = {};

-- function doit()

function process()

    if     rq.GET["cmd"] == "get" then

	return (c:getNode(rq.GET["key"]):value());

    elseif rq.GET["cmd"] == "set" then

	c:getNode(rq.GET["key"]):value(rq.GET["value"]);
	return (c:getNode(rq.GET["key"]):value());

    elseif rq.GET["cmd"] == "event" then
	    print(rq.RequestHeader);

	    local iface = rq.GET["iface"];

	    if not iface then
		return ("event.lua: ERROR: Interface not defined");
	    end

	    if type(r[iface]) ~= "table" then r[iface] = {}; end

	    for k,v in pairs(rq.GET) do
		if (k ~= "iface") and (k ~= "cmd") then
		    r[iface][k] = v;
		end
	    end

	return "OK";

    elseif rq.GET["cmd"] == "revent" then

	iface = rq.GET["iface"];

	if r[iface] then
	    return (tdump(r[iface]));
	else
	    return ("ERROR: no data for interface " .. iface);
	end
    else
	return ("ERROR: unknown command");
    end
end

return ([[
<?xml version="1.0" encoding="utf-8" ?>
<data>]] ..
process() ..
[[
</data>
]]);

-- end

-- print(doit());

